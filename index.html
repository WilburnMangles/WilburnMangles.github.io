<head>
  <title>
    Merry Christmas!
  </title>
  <style>
    #box1 {
      width: 180px;
      height: 135px;
      background: url('1.jpg') 0 0;
      position: absolute;
      left: 0;
      top: 0;
      border: 2px solid black;
      box-sizing: border-box;
      -moz-box-sizing: border-box;
      -webkit-box-sizing: border-box;
    }
    
    #box2 {
      width: 180px;
      height: 135px;
      background: url('1.jpg') -180px 0;
      position: absolute;
      left: 180px;
      top: 0;
      border: 2px solid black;
      box-sizing: border-box;
      -moz-box-sizing: border-box;
      -webkit-box-sizing: border-box;

    }
    
    #box3 {
      width: 180px;
      height: 135px;
      background: url('1.jpg') -360px 0;
      position: absolute;
      left: 360px;
      top: 0px;
      border: 2px solid black;
      box-sizing: border-box;
      -moz-box-sizing: border-box;
      -webkit-box-sizing: border-box;

    }
    
    #box4 {
      width: 180px;
      height: 135px;
      background: url('1.jpg') -540px 0;
      position: absolute;
      left: 540px;
      top: 0;
      border: 2px solid black;
      box-sizing: border-box;
      -moz-box-sizing: border-box;
      -webkit-box-sizing: border-box;
    }

    #box5 {
      width: 180px;
      height: 135px;
      background: url('1.jpg') 0 -135px;
      position: absolute;
      left: 0;
      top: 135px;
      border: 2px solid black;
      box-sizing: border-box;
      -moz-box-sizing: border-box;
      -webkit-box-sizing: border-box;
    }
    
    #box6 {
      width: 180px;
      height: 135px;
      background: url('1.jpg') -180px -135px;
      position: absolute;
      left: 180px;
      top: 135px;
      border: 2px solid black;
      box-sizing: border-box;
      -moz-box-sizing: border-box;
      -webkit-box-sizing: border-box;

    }
    
    #box7 {
      width: 180px;
      height: 135px;
      background: url('1.jpg') -360px -135px;
      position: absolute;
      left: 360px;
      top: 135px;
      border: 2px solid black;
      box-sizing: border-box;
      -moz-box-sizing: border-box;
      -webkit-box-sizing: border-box;

    }
    
    #box8 {
      width: 180px;
      height: 135px;
      background: url('1.jpg') -540px -135px;
      position: absolute;
      left: 540px;
      top: 135px;
      border: 2px solid black;
      box-sizing: border-box;
      -moz-box-sizing: border-box;
      -webkit-box-sizing: border-box;
    }

    #box9 {
      width: 180px;
      height: 135px;
      background: url('1.jpg') 0 -270px;
      position: absolute;
      left: 0;
      top: 270px;
      border: 2px solid black;
      box-sizing: border-box;
      -moz-box-sizing: border-box;
      -webkit-box-sizing: border-box;
    }
    
    #box10 {
      width: 180px;
      height: 135px;
      background: url('1.jpg') -180px -270px;
      position: absolute;
      left: 180px;
      top: 270px;
      border: 2px solid black;
      box-sizing: border-box;
      -moz-box-sizing: border-box;
      -webkit-box-sizing: border-box;

    }
    
    #box11 {
      width: 180px;
      height: 135px;
      background: url('1.jpg') -360px -270px;
      position: absolute;
      left: 360px;
      top: 270px;
      border: 2px solid black;
      box-sizing: border-box;
      -moz-box-sizing: border-box;
      -webkit-box-sizing: border-box;

    }
    
    #box12 {
      width: 180px;
      height: 135px;
      background: url('1.jpg') -540px -270px;
      position: absolute;
      left: 540px;
      top: 270px;
      border: 2px solid black;
      box-sizing: border-box;
      -moz-box-sizing: border-box;
      -webkit-box-sizing: border-box;
    }

    #box13 {
      width: 180px;
      height: 135px;
      background: url('1.jpg') 0 -405px;
      position: absolute;
      left: 0;
      top: 405px;
      border: 2px solid black;
      box-sizing: border-box;
      -moz-box-sizing: border-box;
      -webkit-box-sizing: border-box;
    }
    
    #box14 {
      width: 180px;
      height: 135px;
      background: url('1.jpg') -180px -405px;
      position: absolute;
      left: 180px;
      top: 405px;
      border: 2px solid black;
      box-sizing: border-box;
      -moz-box-sizing: border-box;
      -webkit-box-sizing: border-box;

    }
    
    #box15 {
      width: 180px;
      height: 135px;
      background: url('1.jpg') -360px -405px;
      position: absolute;
      left: 360px;
      top: 405px;
      border: 2px solid black;
      box-sizing: border-box;
      -moz-box-sizing: border-box;
      -webkit-box-sizing: border-box;

    }
    
    #box16 {
      width: 180px;
      height: 135px;
      position: absolute;
      left: 540px;
      top: 405px;
      border: 2px solid black;
      box-sizing: border-box;
      -moz-box-sizing: border-box;
      -webkit-box-sizing: border-box;
    }
  </style>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
  <script type="text/javascript">
    var grid = [
      [1,  2,  3,  4],
      [5,  6,  7,  8],
      [9,  10, 11, 12],
      [13, 14, 15, 16]
    ];

    var isMoving = false;
    var moveInterval;

    var boxes = [null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null, null];

    // ON LOAD
    $(document).ready( function() {
      var i;
      for (i = 1; i <= 16; i++) {
        boxes[i] = $("#box" + i);
      }

      initPuzzle(1);
    });  


    function initPuzzle(puzzleId) {
	grid = [
          [1,  2,  3,  4],
          [5,  6,  7,  8],
          [9,  10, 11, 12],
          [13, 14, 15, 16]
        ];
	updatePositions();

        // Swap Box16 50-100 times.
        var i, x, y, direction, foundSwap, chaosCount;
        var curX = 3, curY = 3, destX, destY;
        // Swap 100 times until most things aren't in their default spot (i.e., is chaotic).
        do {
          console.log('?');
          for (i = 0; i < 100; i++) {
            foundSwap = false;
            while (!foundSwap) {
              direction = Math.floor(Math.random() * 4);
            
              if (direction == 0 && curY > 0) { // FROM ABOVE
                swapBoxes(curX, curY - 1, curX, curY, false);
                curY--;
                foundSwap = true;
              } else if (direction == 1 && curY < 3) { // FROM BELOW
                swapBoxes(curX, curY + 1, curX, curY, false);
                curY++;
                foundSwap = true;
              } else if (direction == 2 && curX > 0) { // FROM LEFT
                swapBoxes(curX - 1, curY, curX, curY, false);
                curX--;
                foundSwap = true;
              } else if (direction == 0 && curX < 3) { // FROM RIGHT
                swapBoxes(curX + 1, curY, curX, curY, false);
                curX++;
                foundSwap = true;
              }
            }
          }

          // Check for chaos
          chaosCount = 0;
          i = 1;
          for (y = 0; y < 4; y++) {
            for (x = 0; x < 4; x++) {
              if (grid[y][x] == i) {
                chaosCount++;
              }
              i++;
            }
          }
        } while (chaosCount > 2);

        updatePositions();
    }

    function tap(box) {
      if (isMoving) {
        return;
      }

      // Get current position
      var x, y;
      var posX = -1, posY = -1;
      for (x = 0; x < 4; x++) {
        for (y = 0; y < 4; y++) {
          if (grid[y][x] == box) {
            posX = x;
            posY = y;
          }
        }
      }

      if (posX == -1 || posY == -1) {
        return;
      }

      // up?
      if (isBox16(posX, posY - 1)) {
        swapBoxes(posX, posY, posX, posY - 1, true);
        return;
      }

      // down?
      if (isBox16(posX, posY + 1)) {
        swapBoxes(posX, posY, posX, posY + 1, true);
        return;
      }

      // left?
      if (isBox16(posX - 1, posY)) {
        swapBoxes(posX, posY, posX - 1, posY, true);
        return;
      }

      // right?
      if (isBox16(posX + 1, posY)) {
        swapBoxes(posX, posY, posX + 1, posY, true);
        return;
      }
    }

    function isBox16(x, y) {
      if (x < 0 || x > 3 || y < 0 || y > 3) {
        return false;
      } else {
        return (grid[y][x] == 16); 
      }
    }

    function updatePositions() {
      var x, y, box;
      for (x = 0; x < 4; x++) {
        for (y = 0; y < 4; y++) {
          box = grid[y][x];
          boxes[box].css({left: 180 * x, top: 135 * y});
        }
      } 
    }

    function swapBoxes(srcX, srcY, destX, destY, isAnimated) {
      var box = grid[srcY][srcX];
      grid[destY][destX] = box;
      grid[srcY][srcX] = 16;

      if (!isAnimated) {
        return;
      }

      // Animate the movement
      var dx = (destX - srcX) * 180 / 15;
      var dy = (destY - srcY) * 135 / 15;
      var curX = srcX * 180;
      var curY = srcY * 135;
      var finalX = destX * 180;
      var finalY = destY * 135;
      moveInterval = setInterval(function() {
        isMoving = true;
        curX += dx;
        curY += dy;
        boxes[box].css({left: curX, top: curY});
        if (curX == finalX && curY == finalY) {
          clearInterval(moveInterval);
          updatePositions();
          isMoving = false;
        }
      }, 5);
    }
  </script>
</head>

<div style="font-size: 200%; text-indent: 5px; text-shadow: 1px 1px 0px white;">
  <div id="box1" onmousedown="tap(1)">1</div>
  <div id="box2" onmousedown="tap(2)">2</div>
  <div id="box3" onmousedown="tap(3)">3</div>
  <div id="box4" onmousedown="tap(4)">4</div>

  <div id="box5" onmousedown="tap(5)">5</div>
  <div id="box6" onmousedown="tap(6)">6</div>
  <div id="box7" onmousedown="tap(7)">7</div>
  <div id="box8" onmousedown="tap(8)">8</div>

  <div id="box9" onmousedown="tap(9)">9</div>
  <div id="box10" onmousedown="tap(10)">10</div>
  <div id="box11" onmousedown="tap(11)">11</div>
  <div id="box12" onmousedown="tap(12)">12</div>

  <div id="box13" onmousedown="tap(13)">13</div>
  <div id="box14" onmousedown="tap(14)">14</div>
  <div id="box15" onmousedown="tap(15)">15</div>
  <div id="box16">16</div>  
</div>